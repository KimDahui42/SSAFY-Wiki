# 싱글톤 패턴

태그: 디자인패턴
CS 주제:  [2주차] 디자인패턴 (https://www.notion.so/2-a262137b3eba4db79de885eca3e85e38?pvs=21)
날짜: 2023년 8월 7일
블로그 게시: No
완료: Yes
작성자: sun
참고자료: https://blog.hexabrain.net/394, https://devmoony.tistory.com/76, https://jh-bk.tistory.com/43
출석: 230807 출석 (https://www.notion.so/230807-e69f8e83c06c4b238938f08f419c73c7?pvs=21)

# 싱글톤 패턴

<aside>
📢 **싱글톤 패턴 (Singleton Pattern)**

애플리캐이션이 시작될 때, 어떤 클래스가 최초 한번만 매모리를 할당하고, 해당 메모리에 인스턴스를 만들어 사용하는 패턴

즉, 인스턴스가 필요할 때, 똑같은 인스턴스를 만들지 않고 ***기존의 인스턴스 ‘하나’만 활용***하는 것

</aside>

  

### 구현

```python
import random

def singleton(class_):
    instances = {}                       # 인스턴스 목록 state 생성

    def get_instance(*args, **kwargs):   # 인스턴스 생성 전 이미 만들어진 인스턴스인지 판단
        if class_ not in instances:      # 없다면 새로운 인스턴스 생성하여 반환
            instances[class_] = class_(*args, **kwargs)
        return instances[class_]

    return get_instance                  # 이미 있다면 해당 인스턴스 반환

@singleton
class Database:
    def __init__(self):
        self.id = random.randint(0, 10000)
        print(f"Instance ID: {self.id}")

=============================================================================

>>> d1 = Database()
Instance ID: 8940              # __init__이 한번만 호출 (한번만 생성)
>>> d2 = Database()

>>> print(d1 == d2)
True
>>> print(d1.id, d2.id)        # 주소값이 동일
8940 8940
```

### 특징

- 객체의 유일성 보장
- 일반적으로 싱글톤 객체에 대한 참조를 public static 필드 혹은 public static 메서드로 노출 
→ 어디에서나 싱글턴 객체에 접근 가능

<aside>
📢 **“왜” 사용하나요?**

1. 메모리 측면의 이점
    
    > 한 개의 인스턴스만을 고정 메모리 영역에  생성하고, 추후 해당 객체를  접근할 때 메모리 낭비를 방지할 수 있음
    > 

1. 속도 측면의 이점 
    
    > 생성된 인스턴스 사용 시, 재생성할 필요가 없이 있던 것을 활용하므로 속도적 이득이 있음
    > 
    
        
    
2. 데이터 공유의 용이성 
    
    > 전역으로 사용하는 인스턴스이므로 다른 여러 클래스에서 데이터를 공유하며 사용할 수 있음 (요청이 많은 곳에서 사용시 효율 ↑) 
    다만, **동시성 문제**가 발생할 수 있으므로 설계시 유의해야 함
    > 
    - 동시성 문제
        - 동일한 하나의 데이터에 2개 이상의 스레드, 혹은 세션에서 가변 데이터를 동시에 제어할 때 나타는 문제
        - 하나의 세션이 데이터를 수정 중일 때, 다른 세션에서 수정 전의 데이터를 조회해 로직을 처리함으로써 데이터의 정합성이 깨지는 문제를 말함
        
</aside>

### 단점

- 싱글톤 인스턴스가 너무 많은 일을 하거나 많은 데이터를 공유시킬 경우, 다른 클래스의 인스턴스 간의 결합도가 높아져 변경에 취약하고 테스트가 어려워짐 **(개방-폐쇄 원칙 위배)**
    
    ⇒ 수정이 어렵고 유지보수의 비용이 높아질 수 있음
    
- 멀티 쓰레드 환경에서 동기화 처리를 안하면 인스턴스가 2개 생성될 수 있는 가능성 有

: 싱글톤 패턴은 꼭 필요한 경우가 아니라면 지양하는 것이 더 바람직